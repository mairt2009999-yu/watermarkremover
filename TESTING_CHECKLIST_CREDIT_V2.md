# ç§¯åˆ†ç³»ç»Ÿ V2 æµ‹è¯•æ¸…å•
# Credit System V2 Testing Checklist

## ğŸ“‹ æµ‹è¯•å‰å‡†å¤‡ (Pre-Testing Setup)

### 1. ç¯å¢ƒé…ç½®
```bash
# ç¡®ä¿ .env.local åŒ…å«ä»¥ä¸‹é…ç½®
NEXT_PUBLIC_CREDIT_SYSTEM_VERSION=v1  # å…ˆæµ‹è¯•V1å…¼å®¹æ€§
NEXT_PUBLIC_ENABLE_CREDIT_PURCHASES=true
DATABASE_URL=postgresql://...
STRIPE_SECRET_KEY=sk_test_...
STRIPE_WEBHOOK_SECRET=whsec_...
CRON_SECRET=your-cron-secret
ADMIN_API_KEY=your-admin-key
```

### 2. æ•°æ®åº“å¤‡ä»½
```bash
# åˆ›å»ºæµ‹è¯•å‰å¤‡ä»½
pg_dump $DATABASE_URL > backup_before_testing_$(date +%Y%m%d_%H%M%S).sql
```

---

## âœ… Phase 1: V1 ç³»ç»Ÿæµ‹è¯• (ç¡®ä¿ç°æœ‰ç³»ç»Ÿæ­£å¸¸)

### åŸºç¡€åŠŸèƒ½æµ‹è¯•
- [ ] **ç”¨æˆ·ç™»å½•**
  - å¯ä»¥æ­£å¸¸ç™»å½•
  - Session æ­£ç¡®åˆ›å»º
  - ç”¨æˆ·ä¿¡æ¯æ­£ç¡®æ˜¾ç¤º

- [ ] **ç§¯åˆ†æ˜¾ç¤º**
  - ç§¯åˆ†ä½™é¢æ­£ç¡®æ˜¾ç¤º
  - ç§¯åˆ†å†å²è®°å½•å¯æŸ¥çœ‹
  - ç§¯åˆ†ä½¿ç”¨è®°å½•å‡†ç¡®

- [ ] **ç§¯åˆ†è´­ä¹° (V1ç‰¹æœ‰)**
  - å¯ä»¥çœ‹åˆ°ç§¯åˆ†åŒ…åˆ—è¡¨
  - å¯ä»¥è´­ä¹°ç§¯åˆ†åŒ…
  - è´­ä¹°åä½™é¢æ›´æ–°æ­£ç¡®

- [ ] **ç§¯åˆ†ä½¿ç”¨**
  - æ°´å°ç§»é™¤æ‰£é™¤ç§¯åˆ†æ­£å¸¸
  - ä½™é¢ä¸è¶³æ—¶æ­£ç¡®æç¤º
  - äº¤æ˜“è®°å½•æ­£ç¡®ç”Ÿæˆ

---

## âœ… Phase 2: V2 ç³»ç»Ÿæµ‹è¯• (æ–°ç³»ç»ŸåŠŸèƒ½)

### 1. åˆ‡æ¢åˆ°V2æ¨¡å¼
```bash
# æ›´æ–°ç¯å¢ƒå˜é‡
NEXT_PUBLIC_CREDIT_SYSTEM_VERSION=v2
NEXT_PUBLIC_ENABLE_CREDIT_PURCHASES=false

# é‡å¯å¼€å‘æœåŠ¡å™¨
pnpm dev
```

### 2. UIå˜åŒ–éªŒè¯
- [ ] **ç§¯åˆ†è´­ä¹°å…¥å£**
  - ç§¯åˆ†è´­ä¹°æŒ‰é’®ä¸å†æ˜¾ç¤º
  - è´­ä¹°ç§¯åˆ†åŒ…é¡µé¢ä¸å¯è®¿é—®
  - ä½™é¢ä¸è¶³æ—¶åªæ˜¾ç¤ºå‡çº§é€‰é¡¹

- [ ] **å®šä»·é¡µé¢**
  - æ¯ä¸ªè®¢é˜…è®¡åˆ’æ˜¾ç¤ºåŒ…å«ç§¯åˆ†æ•°
  - Free: 5 ç§¯åˆ†/æœˆ
  - Pro Monthly: 100 ç§¯åˆ†/æœˆ
  - Pro Yearly: 150 ç§¯åˆ†/æœˆ
  - Lifetime: 500 ç§¯åˆ†/æœˆ

### 3. è®¢é˜…åŠŸèƒ½æµ‹è¯•

#### æ–°ç”¨æˆ·æ³¨å†Œ
- [ ] æ³¨å†Œæ–°ç”¨æˆ·è´¦å·
- [ ] è‡ªåŠ¨è·å¾— 5 ä¸ªå…è´¹ç§¯åˆ†
- [ ] ç§¯åˆ†ä½™é¢æ­£ç¡®æ˜¾ç¤º

#### è®¢é˜…è´­ä¹°æµç¨‹
- [ ] **è´­ä¹° Pro Monthly**
  - Stripe Checkout æ­£å¸¸æ‰“å¼€
  - æ”¯ä»˜æˆåŠŸåè¿”å›
  - ç§¯åˆ†è‡ªåŠ¨åˆ†é… (100ç§¯åˆ†)
  - è®¢é˜…çŠ¶æ€æ­£ç¡®

- [ ] **è´­ä¹° Pro Yearly**
  - æ”¯ä»˜æµç¨‹æ­£å¸¸
  - ç§¯åˆ†åˆ†é…æ­£ç¡® (150ç§¯åˆ†)
  - å¹´ä»˜æ ‡è¯†æ­£ç¡®

- [ ] **è´­ä¹° Lifetime**
  - ä¸€æ¬¡æ€§æ”¯ä»˜æ­£å¸¸
  - ç§¯åˆ†åˆ†é…æ­£ç¡® (500ç§¯åˆ†)
  - æ°¸ä¹…ä¼šå‘˜æ ‡è¯†æ­£ç¡®

### 4. è®¢é˜…ç®¡ç†æµ‹è¯•

#### å‡çº§æµ‹è¯•
- [ ] **Free â†’ Pro Monthly**
  - å‡çº§æµç¨‹æ­£å¸¸
  - ç§¯åˆ†ä» 5 â†’ 100
  - åŸæœ‰ç§¯åˆ†ä¿ç•™

- [ ] **Pro Monthly â†’ Pro Yearly**
  - å‡çº§æµç¨‹æ­£å¸¸
  - ç§¯åˆ†è°ƒæ•´ä¸º 150
  - è®¡è´¹å‘¨æœŸæ­£ç¡®

#### é™çº§æµ‹è¯•
- [ ] **Pro Yearly â†’ Pro Monthly**
  - é™çº§åœ¨å‘¨æœŸç»“æŸåç”Ÿæ•ˆ
  - ç§¯åˆ†åœ¨ä¸‹ä¸ªå‘¨æœŸè°ƒæ•´
  - ç”¨æˆ·æ”¶åˆ°é€šçŸ¥

#### å–æ¶ˆæµ‹è¯•
- [ ] **å–æ¶ˆè®¢é˜…**
  - å¯ä»¥æˆåŠŸå–æ¶ˆ
  - ç§¯åˆ†ä¿ç•™åˆ°å‘¨æœŸç»“æŸ
  - å‘¨æœŸç»“æŸåç§¯åˆ†å½’é›¶

### 5. Webhook æµ‹è¯•

ä½¿ç”¨ Stripe CLI æµ‹è¯• webhooks:
```bash
# å®‰è£… Stripe CLI
brew install stripe/stripe-cli/stripe

# ç™»å½•
stripe login

# è½¬å‘ webhooks åˆ°æœ¬åœ°
stripe listen --forward-to localhost:3000/api/webhooks/stripe

# åœ¨å¦ä¸€ä¸ªç»ˆç«¯è§¦å‘æµ‹è¯•äº‹ä»¶
stripe trigger customer.subscription.created
stripe trigger customer.subscription.updated
stripe trigger customer.subscription.deleted
stripe trigger checkout.session.completed
```

éªŒè¯æ¯ä¸ªäº‹ä»¶:
- [ ] subscription.created - ç§¯åˆ†æ­£ç¡®åˆ†é…
- [ ] subscription.updated - ç§¯åˆ†æ­£ç¡®è°ƒæ•´
- [ ] subscription.deleted - ç§¯åˆ†æ­£ç¡®å¤„ç†
- [ ] checkout.session.completed - ä¸€æ¬¡æ€§æ”¯ä»˜ç§¯åˆ†åˆ†é…

### 6. Cron Job æµ‹è¯•

#### æ‰‹åŠ¨è§¦å‘æœˆåº¦é‡ç½®
```bash
# ä½¿ç”¨ç®¡ç†å‘˜å¯†é’¥
curl -X POST http://localhost:3000/api/cron/reset-credits \
  -H "x-admin-key: your-admin-key"
```

éªŒè¯:
- [ ] æ‰€æœ‰æ´»è·ƒè®¢é˜…ç”¨æˆ·ç§¯åˆ†é‡ç½®
- [ ] ç§¯åˆ†æ•°é‡ç¬¦åˆè®¢é˜…è®¡åˆ’
- [ ] é‡ç½®è®°å½•æ­£ç¡®ç”Ÿæˆ
- [ ] é”™è¯¯ç”¨æˆ·è¢«è®°å½•

### 7. API ç«¯ç‚¹æµ‹è¯•

#### ç§¯åˆ†çŠ¶æ€ç«¯ç‚¹
```bash
curl http://localhost:3000/api/credits/status
```

éªŒè¯å“åº”:
- [ ] ç³»ç»Ÿç‰ˆæœ¬æ­£ç¡® (v2)
- [ ] åŠŸèƒ½æ ‡è¯†æ­£ç¡®
- [ ] ç”¨æˆ·ä½™é¢æ­£ç¡®ï¼ˆå¦‚å·²ç™»å½•ï¼‰

---

## âœ… Phase 3: æ•°æ®è¿ç§»æµ‹è¯•

### 1. åœ¨æµ‹è¯•æ•°æ®åº“è¿è¡Œè¿ç§»
```bash
# åˆ›å»ºæµ‹è¯•æ•°æ®åº“å‰¯æœ¬
createdb watermark_test
pg_dump $DATABASE_URL | psql watermark_test

# è¿è¡Œè¿ç§»è„šæœ¬
./scripts/run-credit-migration.sh
```

### 2. éªŒè¯è¿ç§»ç»“æœ
- [ ] credit_packages è¡¨å·²åˆ é™¤
- [ ] credit_purchases è¡¨å·²åˆ é™¤
- [ ] user_credits.purchased_credits åˆ—å·²åˆ é™¤
- [ ] subscription_credit_config æ›´æ–°æ­£ç¡®
- [ ] ç”¨æˆ·ç§¯åˆ†ä½™é¢è°ƒæ•´æ­£ç¡®

### 3. æµ‹è¯•å›æ»š
```bash
# è¿è¡Œå›æ»šè„šæœ¬
psql watermark_test < src/db/migrations/0003_rollback_credit_system.sql
```

éªŒè¯:
- [ ] è¡¨ç»“æ„æ¢å¤
- [ ] æ•°æ®å®Œæ•´æ€§ä¿æŒ
- [ ] ç³»ç»Ÿå¯ä»¥åˆ‡å›V1

---

## âœ… Phase 4: æ€§èƒ½æµ‹è¯•

### è´Ÿè½½æµ‹è¯•
- [ ] 100ä¸ªå¹¶å‘ç”¨æˆ·ç§¯åˆ†æŸ¥è¯¢
- [ ] 50ä¸ªå¹¶å‘ç§¯åˆ†æ‰£é™¤æ“ä½œ
- [ ] å“åº”æ—¶é—´ < 100ms
- [ ] æ— æ•°æ®åº“é”é—®é¢˜

### å‹åŠ›æµ‹è¯•
- [ ] æœˆåº¦é‡ç½® 1000+ ç”¨æˆ·
- [ ] æ‰¹é‡è®¢é˜…åˆ›å»º
- [ ] Webhook æ‰¹é‡å¤„ç†
- [ ] ç³»ç»Ÿä¿æŒç¨³å®š

---

## âœ… Phase 5: è¾¹ç•Œæƒ…å†µæµ‹è¯•

### å¼‚å¸¸åœºæ™¯
- [ ] ç§¯åˆ†ä½™é¢ä¸º0æ—¶çš„æ“ä½œ
- [ ] è´Ÿæ•°ç§¯åˆ†å¤„ç†
- [ ] å¹¶å‘æ‰£é™¤ç§¯åˆ†
- [ ] ç½‘ç»œä¸­æ–­æ¢å¤
- [ ] æ•°æ®åº“è¿æ¥å¤±è´¥

### é”™è¯¯å¤„ç†
- [ ] Webhook ç­¾åéªŒè¯å¤±è´¥
- [ ] Stripe API è°ƒç”¨å¤±è´¥
- [ ] ç§¯åˆ†åˆ†é…å¤±è´¥ä½†è®¢é˜…æˆåŠŸ
- [ ] Cron job éƒ¨åˆ†å¤±è´¥

---

## ğŸ“Š æµ‹è¯•æŠ¥å‘Šæ¨¡æ¿

### æµ‹è¯•ç¯å¢ƒ
- **æ—¥æœŸ**: ___________
- **æµ‹è¯•äººå‘˜**: ___________
- **ç¯å¢ƒ**: Development / Staging / Production
- **æ•°æ®åº“**: PostgreSQL ç‰ˆæœ¬ _____
- **Node.js**: ç‰ˆæœ¬ _____

### æµ‹è¯•ç»“æœæ±‡æ€»
| æµ‹è¯•é˜¶æ®µ | é€šè¿‡é¡¹ | å¤±è´¥é¡¹ | é€šè¿‡ç‡ |
|---------|--------|--------|--------|
| V1å…¼å®¹æ€§ | ___ | ___ | ___% |
| V2åŠŸèƒ½  | ___ | ___ | ___% |
| æ•°æ®è¿ç§» | ___ | ___ | ___% |
| æ€§èƒ½æµ‹è¯• | ___ | ___ | ___% |
| è¾¹ç•Œæµ‹è¯• | ___ | ___ | ___% |

### å‘ç°çš„é—®é¢˜
1. **é—®é¢˜æè¿°**: 
   - **ä¸¥é‡ç¨‹åº¦**: é«˜/ä¸­/ä½
   - **å¤ç°æ­¥éª¤**: 
   - **è§£å†³æ–¹æ¡ˆ**: 

### æµ‹è¯•ç»“è®º
- [ ] **é€šè¿‡** - å¯ä»¥éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ
- [ ] **æ¡ä»¶é€šè¿‡** - ä¿®å¤ä»¥ä¸‹é—®é¢˜åå¯éƒ¨ç½²: _____
- [ ] **æœªé€šè¿‡** - éœ€è¦é‡æ–°æµ‹è¯•

### ç­¾å­—ç¡®è®¤
- **æµ‹è¯•è´Ÿè´£äºº**: _________ æ—¥æœŸ: _________
- **æŠ€æœ¯è´Ÿè´£äºº**: _________ æ—¥æœŸ: _________
- **é¡¹ç›®è´Ÿè´£äºº**: _________ æ—¥æœŸ: _________

---

## ğŸš€ éƒ¨ç½²å‰æœ€ç»ˆæ£€æŸ¥

### ä»£ç å‡†å¤‡
- [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡
- [ ] ä»£ç å·²æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶
- [ ] åˆ›å»ºäº†å‘å¸ƒæ ‡ç­¾
- [ ] æ›´æ–°äº† CHANGELOG

### ç¯å¢ƒå‡†å¤‡
- [ ] ç”Ÿäº§æ•°æ®åº“å·²å¤‡ä»½
- [ ] ç¯å¢ƒå˜é‡å·²é…ç½®
- [ ] ç›‘æ§å‘Šè­¦å·²è®¾ç½®
- [ ] å›æ»šæ–¹æ¡ˆå·²å‡†å¤‡

### å›¢é˜Ÿå‡†å¤‡
- [ ] è¿ç»´å›¢é˜Ÿå·²é€šçŸ¥
- [ ] å®¢æœå›¢é˜Ÿå·²åŸ¹è®­
- [ ] ç”¨æˆ·é€šçŸ¥å·²å‡†å¤‡
- [ ] åº”æ€¥å“åº”è®¡åˆ’å°±ç»ª

---

## ğŸ“ ç´§æ€¥è”ç³»

- **æŠ€æœ¯æ”¯æŒ**: tech@watermarkremover.io
- **æ•°æ®åº“ç®¡ç†å‘˜**: dba@watermarkremover.io
- **äº§å“ç»ç†**: pm@watermarkremover.io
- **å€¼ç­ç”µè¯**: +86-xxx-xxxx

---

**æ³¨æ„**: æœ¬æµ‹è¯•æ¸…å•æ˜¯éƒ¨ç½²ç§¯åˆ†ç³»ç»ŸV2çš„å…³é”®æ–‡æ¡£ï¼Œè¯·ç¡®ä¿æ¯ä¸ªæ­¥éª¤éƒ½è®¤çœŸæ‰§è¡Œå¹¶è®°å½•ç»“æœã€‚